<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 변경</title>
    <style>
        @font-face {
            font-family: 'Pretendard4';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'Pretendard5';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Medium.woff') format('woff');
            font-weight: 500;
            font-display: swap;
        }

        @font-face {
            font-family: 'Pretendard6';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-SemiBold.woff') format('woff');
            font-weight: 600;
            font-display: swap;
        }

        @font-face {
            font-family: 'Pretendard7';
            src: url('https://cdn.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Bold.woff') format('woff');
            font-weight: 700;
            font-display: swap;
        }
         * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Pretendard4', sans-serif;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
        }
        
        .header {
            padding: 30px 0;
            text-align: center;
            margin: 0 auto;   
        }

        .header div{
            font-size: 25px;
            font-weight: 700;
            color: #222;
        }
        
        
        .btn {
            background-color: white;
            border: 1px solid #ccc;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
        }
        
        
        .btn-primary {
            background-color: black;
            color: white;
        }
        
        .form-section {
            border: 1px solid black;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        
        
        .error-message {
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .success-message {
            color : #035fe0;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        #blank{
            height : 10px;
        }

        .password-requirements {
            border: 1px solid black;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        .password-requirements a {
            font-size : 14px;
            font-weight : 500;
        }
        
        .password-requirements ul {
            margin-left: 20px;
        }
        
        .password-requirements li {
            margin-bottom: 3px;
        }
        
        .form-buttons {
            text-align: center;
            margin-top : 45px;
        }
        
        .form-buttons button {
            margin: 0 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div>비밀번호 변경</div>
        </div>
        
        <div class="content">
            
            <div class="password-requirements">
                <a>비밀번호 요구사항</a>
                <div id = "blank">

                </div>
                <ul>
                    <li>8자 이상 16자 이하</li>
                    <li>영문 대문자, 소문자, 숫자, 특수문자 중 3가지 이상 포함</li>
                </ul>
            </div>
            
            <form id="passwordForm">
                <div class="form-section">
                    <div class="form-group">
                        <label for="currentPassword">현재 비밀번호</label>
                        <input type="password" id="currentPassword" name="currentPassword" required>
                        <div class="error-message" id="currentPasswordError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">새 비밀번호</label>
                        <input type="password" id="newPassword" name="newPassword" required>
                        <div class="error-message" id="newPasswordError"></div>
                        <div class="success-message" id="newPasswordSuccess"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">새 비밀번호 확인</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required>
                        <div class="error-message" id="confirmPasswordError"></div>
                        <div class="success-message" id="confirmPasswordSuccess"></div>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="btn" onclick="cancelAction()">취소</button>
                    <button type="submit" class="btn btn-primary">비밀번호 변경</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>

        function cancelAction() {
                window.close(); // 취소 버튼 클릭 시 팝업 닫기
            }

        // 비밀번호 유효성 검사
        function validatePassword(password) {
            const minLength = 8;
            const maxLength = 16;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasNumbers = /\d/.test(password);
            const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            const hasConsecutive = /(.)\1{2,}/.test(password) || /012|123|234|345|456|567|678|789|890|abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz/i.test(password);
            
            const criteria = [hasUpperCase, hasLowerCase, hasNumbers, hasSpecialChar];
            const metCriteria = criteria.filter(Boolean).length;
            
            if (password.length < minLength || password.length > maxLength) {
                return { valid: false, message: '비밀번호는 8자 이상 16자 이하여야 합니다.' };
            }
            
            if (metCriteria < 3) {
                return { valid: false, message: '영문 대문자, 소문자, 숫자, 특수문자 중 3가지 이상 포함해야 합니다.' };
            }
            
            if (hasConsecutive) {
                return { valid: false, message: '연속된 문자나 숫자 3개 이상 사용할 수 없습니다.' };
            }
            
            return { valid: true, message: '사용 가능한 비밀번호입니다.' };
        }
        
        // 실시간 비밀번호 검증
        document.getElementById('newPassword').addEventListener('input', function() {
            const password = this.value;
            const errorElement = document.getElementById('newPasswordError');
            const successElement = document.getElementById('newPasswordSuccess');
            
            if (password.length === 0) {
                errorElement.style.display = 'none';
                successElement.style.display = 'none';
                return;
            }
            
            const validation = validatePassword(password);
            
            if (validation.valid) {
                errorElement.style.display = 'none';
                successElement.textContent = validation.message;
                successElement.style.display = 'block';
            } else {
                successElement.style.display = 'none';
                errorElement.textContent = validation.message;
                errorElement.style.display = 'block';
            }
        });
        
        // 비밀번호 확인 검증
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.value;
            const errorElement = document.getElementById('confirmPasswordError');
            const successElement = document.getElementById('confirmPasswordSuccess');
            
            if (confirmPassword.length === 0) {
                errorElement.style.display = 'none';
                successElement.style.display = 'none';
                return;
            }
            
            if (newPassword !== confirmPassword) {
                successElement.style.display = 'none';
                errorElement.textContent = '새 비밀번호와 일치하지 않습니다.';
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
                successElement.textContent = '비밀번호가 일치합니다.';
                successElement.style.display = 'block';
            }
        });
        
        // 폼 제출 처리
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // 현재 비밀번호 확인
            if (!currentPassword) {
                document.getElementById('currentPasswordError').textContent = '현재 비밀번호를 입력해주세요.';
                document.getElementById('currentPasswordError').style.display = 'block';
                return;
            }
            
            // 새 비밀번호 유효성 검사
            const passwordValidation = validatePassword(newPassword);
            if (!passwordValidation.valid) {
                return;
            }
            
            // 비밀번호 확인
            if (newPassword !== confirmPassword) {
                return;
            }
            
            // API 호출 시뮬레이션
            changePassword(currentPassword, newPassword);
        });
        
        // 비밀번호 변경 API 호출 (시뮬레이션)
        function changePassword(currentPassword, newPassword) {
            // 실제로는 여기서 서버 API를 호출합니다
            // fetch('/api/change-password', { ... })
            
            // 시뮬레이션을 위한 임시 처리
            const loadingButton = document.querySelector('.btn-primary');
            loadingButton.textContent = '변경 중...';
            loadingButton.disabled = true;
            
            setTimeout(() => {
                // 현재 비밀번호 검증 시뮬레이션
                if (currentPassword !== 'oldpassword123') {
                    document.getElementById('currentPasswordError').textContent = '현재 비밀번호가 일치하지 않습니다.';
                    document.getElementById('currentPasswordError').style.display = 'block';
                    loadingButton.textContent = '비밀번호 변경';
                    loadingButton.disabled = false;
                    return;
                }
                
                // 성공 처리
                alert('비밀번호가 성공적으로 변경되었습니다.');
                resetForm();
                loadingButton.textContent = '비밀번호 변경';
                loadingButton.disabled = false;
                
                // 실제로는 로그아웃 처리하거나 로그인 페이지로 이동
                // window.location.href = '/login';
                
            }, 1500); // 1.5초 로딩 시뮬레이션
        }
        
        // 폼 리셋
        function resetForm() {
            location.href = "mypage_member.html";
        }
        
        // 현재 비밀번호 에러 메시지 숨기기 (입력 시)
        document.getElementById('currentPassword').addEventListener('input', function() {
            document.getElementById('currentPasswordError').style.display = 'none';
        });
    </script>
</body>
</html>